import { JMSNavSetting } from '@/icons'
import { Callout } from 'nextra/components'
 

# Authentication


This topic describes how to configure third-party authentication services and related user authentication settings.

## Configure email suffix

If the user from the third-party authentication does not have an email field configured, the email suffix is used to automatically generate the user email address by combining the username with the suffix.

**Please follow the steps below to configure email suffix.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Basic**.
3. In the **Email suffix** field, enter the email suffix (such as: `example.com`).
<img src="/images/docs/admin-guides/system-settings/auth/email-suffix.png" alt="image" width="450"/>
4. Click **Submit**.

## Modify the forgot password URL

When the user clicks the **Forgot password?** on the login page, they will be redirected to this URL.
<img src="/images/docs/admin-guides/system-settings/auth/login-page-forgot-password.png" alt="image" width="350"/>

**Please follow the steps below to modify the forgot password URL.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Basic**.
3. In the **Forgot password URL** field, enter the URL for the forgot password link.
<img src="/images/docs/admin-guides/system-settings/auth/forgot-password-url.png" alt="image" width="450"/>
4. Click **Submit**.

## Enable or disable user login redirection
When enabled, when an unauthenticated user accesses JumpServer, they will be redirected to a prompt page where they can choose to **Cancel** or **Confirm** the redirection. 

When disabled, the user will be directly redirected to the third-party authentication page.

<img src="/images/docs/admin-guides/system-settings/auth/redirecting.png" alt="image" width="450"/>

**Please follow the steps below to enable or disable login redirection.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Basic**.
3. In the **Login redirection** field, enable or disable the user login redirection.
    <img src="/images/docs/admin-guides/system-settings/auth/login-redirection.png" alt="image" width="450"/>
4. Click **Submit**.

## Configure LDAP (HA) server

**Lightweight Directory Access Protocol (LDAP)** is an open protocol used for accessing and managing distributed directory information. It is commonly used for centralized authentication and directory services, such as storing user accounts, permissions, and organizational structure information. LDAP is widely applied in enterprise identity management, single sign-on (SSO), and access control systems.

**Distinguished Name (DN)** is unique identifier for each entry in an LDAP directory, similar to a file path in a filesystem (such as: `cn=admin,ou=Users,dc=example,dc=com`).

**Organizational Unit (OU)** is used to organize and manage objects in an LDAP directory, similar to folders in a file system. For example, an organization may have multiple OUs (such as: `ou=HR` and `ou=IT`), to distinguish users and resources of different departments.

**LDAP (HA)** refers to the authentication setup for **LDAP** and **LDAP HA (High Availability)**, merged into one guide due to their similarity.

**Please follow the steps below to configure LDAP or LDAP HA service authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. In the **LDAP (HA)** field, enable or disable the LDAP authentication.
4. In the **Server** field, enter the LDAP server URI (such as: `ldap://example.com:389`, `ldaps://example.com:636`). 

    <Callout type="info" emoji="️💡"> 
      To configure LDAP TLS certificates, you need upload the following files to the default directory `/data/jumpserver/core/data/certs`, then restart the service:
        * **LDAP**: `ldap_ca.pem`, `ldap_cert.pem`, `ldap_cert.key`
        * **LDAP HA**: `ldap_ha_ca.pem`, `ldap_ha_cert.pem`, `ldap_ha_cert.key`
    </Callout>

5. In the **Bind DN** field, enter a user DN with at least query permissions, which will be used to query and filter users. (such as: `cn=admin,dc=example,dc=com`).
6. In the **Password** field, enter the password for the **Bind DN** user.
7. In the **Search OU** field, enter the search OU to specify where to start searching for users, use `|` to separate multiple values (such as:  `ou=users,dc=example,dc=com | ou=tech,dc=example,dc=com`).
    <img src="/images/docs/admin-guides/system-settings/auth/ldap-search.png" alt="image" width="550"/>

8. In the **Search filter** field, enter the filter expression to search for LDAP users. By default, the expression is **(cn=%(user)s)**, where **%(user)s** is the placeholder syntax in Python. During filtering, it is replaced with **\***, resulting in **(cn=\*)**, which searches for all users. You can also replace **cn** with the actual username field, such as **uid** or **sAMAccountName**.

9. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (Available keys: `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the LDAP user attribute name.

10. In the **Connect timeout (s)** field, enter the LDAP connection timeout in seconds.
11. In the **Search paged size (piece)** field, enter the page size for searching users.

12. In the **User DN cache timeout (s)** field, enter the cache duration for user DN (in seconds) to improve login authentication speed. Submit the form to clear the cache if the user DN is changed, otherwise, authentication will fail.

13. Click **Submit**.

### Test LDAP (HA) connection
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Scroll to the bottom of the page and click the **Test connection** button.
4. If the connection is successful, a popup at the top of the page will display the number of matched users.
<img src="/images/docs/admin-guides/system-settings/auth/ldap-test-success.png" alt="image" width="450"/>
5. If the connection fails, please adjust the configuration parameters based on the error message and try again.

### Test LDAP (HA) user login
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Complete the LDAP configuration and click **Submit**, then test the connection successfully.
4. Scroll to the bottom of the page and click the **Test login** button.
5. In the popup, enter the LDAP username and password, then click **Confirm**.
<img src="/images/docs/admin-guides/system-settings/auth/ldap-test-login-popup.png" alt="image" width="650"/>

### Import LDAP (HA) users
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Complete the LDAP configuration and click **Submit**, then test the connection successfully.
4. Scroll to the bottom of the page and click the **User import** button.
5. In the popup, you can perform the following actions:
    * Click the **Sync users** button at the bottom of the table to sync LDAP users to the current table.
    * In the **Import organization** field at the bottom left of the table, select one or more organizations to import.
    * Select the users you want to import in the table, then click the **Import** button at the bottom to continue.
    * Click **Import all** at the bottom of the table to import all users.
    * Click **Cancel** at the bottom of the table to close the popup
    <img src="/images/docs/admin-guides/system-settings/auth/ldap-import-user.png" alt="image" width="650"/>

### Set up LDAP (HA) user sync
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Complete the LDAP configuration and click **Submit**, then test the connection successfully.
4. Scroll to the bottom of the page and click the **Sync settings** button.
5. In the popup, you can perform the following actions:
    * In the **Organization** field, Select one or more organizations, and the users will be synced to these organizations.
    * In the **Periodic** field, enable or disable the periodic sync.
    * Optionally, in the **Crontab** field, enter the crontab expression for the periodic sync. If empty, **Interval** will be used.
    * Optionally, in the **Interval** field, enter the sync interval in hour. If **Crontab** has a value, prefer using crontab.
    * In the **Recipients** fields, select one or more users to receive the sync result.
    * Click **Confirm** to save the settings.
    <img src="/images/docs/admin-guides/system-settings/auth/ldap-sync-settings.png" alt="image" width="550"/>

## Configure CAS server

**Central Authentication Service (CAS)** is a Single Sign-On (SSO) protocol designed to provide centralized authentication for multiple applications. Developed by Yale University, CAS allows users to access multiple protected services with a single login, eliminating the need to re-enter credentials. It implements authentication through a **ticket** mechanism and supports various identity providers, such as databases, LDAP, and OAuth.

**Please follow the steps below to configure Passkey service authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > CAS**.
3. In the **CAS** field, enable or disable the CAS authentication.
4. In the **Server** field, enter the CAS server URI (such as: `https://example.com/cas`).
5. In the **Proxy server** field,  enter the CAS proxy server URI if behind a proxy. For example, if the host listens on `http://foo.bar:8080` but requests use `https://foo.bar:8443`, enter `https://foo.bar:8443`.
6. In the **Version** field, enter the CAS protocol version (Supported versions: `1`, `2`, `3`, `CAS_2_SAML_1_0`).
7. In the **User attribute** field, enter the user attribute mapping. The key is the CAS user attribute name, and the value is the JumpServer user attribute name (Available values: `name`, `username`, `email`, `groups`).
<img src="/images/docs/admin-guides/system-settings/auth/cas-user-attribute.png" alt="image" width="550"/>
8. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
9. In the **Create user** field, when enabled, a user will be created upon successful authentication. When disabled and the user does not exist, authentication will fail.
10. In the **Logout completely** field, When enabled, logging out will also log the user out from the CAS service.
11. Click **Submit**.

## Configure Passkey server

**Passkey** is a passwordless authentication technology based on public-key cryptography. It replaces traditional passwords to enhance security and user experience. Passkey is supported by the FIDO2 standard (including WebAuthn and CTAP) and allows users to authenticate using biometrics (fingerprint or facial recognition), a PIN, or a security key without entering a password.

**Fast Identity Online (FIDO)** is an open standard designed to provide a more secure, passwordless authentication method. It is developed by the FIDO Alliance and primarily includes FIDO UAF (Universal Authentication Framework) and FIDO2 (which consists of the WebAuthn and CTAP protocols).

**Please follow the steps below to configure Passkey service authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Passkey**.
3. In the **Passkey** field, enable or disable the Passkey authentication.
4. In the **FIDO server ID** field, enter the full domain name of JumpServer. If not set, it defaults to the request host and matches domains in `DOMAINS` from `config.txt` file. If there are multiple domains, separate them with commas.
5. In the **FIDO server name** field, enter the server name, the default value is `JumpServer`.

## Configure OIDC server

**OpenID Connect (OIDC)** is an identity authentication protocol based on **OAuth 2.0**. It allows applications to verify a user’s identity through an **authorization server** and obtain basic user information (such as username and email). It adds an identity layer on top of OAuth 2.0, using an **ID Token** to transmit user identity information, and is widely used for Single Sign-On (SSO) and identity authentication systems.

**Relying Party (RP)** is an application or client that uses authentication services and relies on the OpenID provider to authenticate the user and provide identity information.

**OpenID Provider (OP)** is the server responsible for verifying the user’s identity and providing identity information to the RP.

<Callout type="info" emoji="️💡"> 
  Below is the JumpServer URL information required for OpenID Provider setup.  
    * **Login**: `https://jumpserver.example.com/core/auth/openid/login/`
    * **Logout**: `https://jumpserver.example.com/core/auth/openid/logout/`
    * **Login success callback**: `https://jumpserver.example.com/core/auth/openid/callback/`
</Callout>

**Please follow the steps below to configure OIDC service authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.

    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > OIDC**.
3. In the **OIDC** field, enable or disable the OIDC authentication.
4. In the **Base site URL** field, enter the full domain name of JumpServer, which is used to construct the callback URL.
5. In the **Client id** field, enter the client id provided by the OIDC server.
6. In the **Client secret** field, enter the client secret provided by the OIDC server.
7. In the **Request method** field, select a method to obtain a token.

    * **Client Secret Basic**: The `Client id` and `Client secret` are sent in the request headers.
    * **Client Secret Post**: The `Client id` and `Client secret` are sent in the request body.
    <img src="/images/docs/admin-guides/system-settings/auth/oidc-request-method.png" alt="image" width="550"/>

8. In the **Use keycloak** field, when enabled, Keycloak configuration will be used. The following fields must be provided:

    * **Server**: Enter the Keycloak server URI.
    * **Realm name**: Enter the Keycloak realm name.
    <img src="/images/docs/admin-guides/system-settings/auth/oidc-use-keycloak.png" alt="image" width="550"/>

9. In the **Use keycloak** field, when disabled, native OIDC configuration will be used for better compatibility with other OIDC providers. The following fields must be provided:

    * **Provider endpoint**: Enter the OIDC provider endpoint (such as: `https://oidc.example.com`).
    * **Authorization endpoint**: Enter the OIDC authorization endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/auth/`).
    * **Token endpoint**: Enter the OIDC token endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/token/`).
    * **JWKS endpoint**: Enter the OIDC JSON Web Key Set (JWKS) endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/certs/`).
    * **Userinfo endpoint**: Enter the OIDC userinfo endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/userinfo/`).
    * **End session endpoint**: Enter the OIDC end session endpoint, when the user logs out, this endpoint will be called. (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/logout/`).
    * **Signature algorithm**: Enter the OIDC signature algorithm, valid options are `HS256` and `RS256`.
        * **HS256**: Uses the **Client id** as the shared key.
        * **RS256**: Uses the **Signing Key** as the shared key.
        <Callout type="info" emoji="️💡"> 
          The **shared key** in this function is used for Hash-based Message Authentication Code (HMAC) signatures when verifying ID token in an OIDC authentication flow.
        </Callout>
    * **Signing key**: When the **Signature algorithm** is `RS256`, the signing key will be used for HMAC signature verification or JSON Web Token (JWK) decryption to ensure the security of OIDC authentication.
    * **Enable PKCE**: Enable Proof Key for Code Exchange (PKCE) protects the authorization code flow to prevent authorization code interception attacks.
    * **Scopes**: Defines the range of user information that the client requests access to from the OP in an authorization request. Multiple pieces of information are separated by spaces (such as: `openid profile email`).
    * **ID token max age (s)**: The maximum age of the ID token, in seconds. After it expires, a new one will be automatically obtained using the refresh token.
    * **ID token include claims**: When enabled, the ID token includes the userinfo scope and claims. When disabled, claims will be retrieved from the userinfo endpoint provided by the OP. Refer to the [Standard Claims](https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims).
    * **Use state**: Recommend to enable, state can prevent Cross-Site Request Forgery (CSRF) attacks and ensure consistency between the request and the callback.
    * **Use nonce**: Recommend to enable too, nonce can prevent replay attacks.
    <img src="/images/docs/admin-guides/system-settings/auth/oidc-use-native.png" alt="image" width="700"/>

10. In the **Always update user** field, when enabled, after OIDC user authentication, user information (only includes: `name`, `username`, `email`, `phone`, `comment`) will be checked and updated each time, `groups` are only synchronized when the user is created..
11. In the **Ignore SSL verification** field, when enabled, SSL certificate verification is ignored when sending requests to the OP.
12. In the **Share session** field, when enabled, the session will be logged out simultaneously when a user logs out from other applications.
13. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (such as: `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the OIDC user attribute name.

    <img src="/images/docs/admin-guides/system-settings/auth/oidc-user-attribute.png" alt="image" width="550"/>

14. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.

## Configure SAML2 server

**Security Assertion Markup Language 2.0 (SAML2)** is an open standard for exchanging authentication and authorization data between parties, particularly between an Identity Provider and a Service Provider. It allows users to authenticate once with the IdP and access multiple services (SPs) without needing to re-enter credentials.

**Identity Provider (IdP)** is a system that authenticates users and provides their identity information to service providers.

**Service Provider (SP)** is a system or application that relies on an IdP to authenticate users and grant access to its services based on the user identity.

In this case, JumpServer acts only as the SP.

<Callout type="info" emoji="️💡"> 
  Below is the JumpServer URL information required for IdP SAML2 setup.  
    * **Login**: `https://jumpserver.example.com/core/auth/saml2/login/`
    * **Logout**: `https://jumpserver.example.com/core/auth/saml2/logout/`
    * **Login success callback**: `https://jumpserver.example.com/core/auth/saml2/callback/`
    * **SP metadata**: `https://jumpserver.example.com/core/auth/saml2/metadata/`
</Callout>


**Please follow the steps below to configure SAML2 service authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.

    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > SAML2**.
3. In the **SAML2** field, enable or disable the SAML2 authentication.
4. In the **SP private key** field, upload the SP private key file.
5. In the **SP cert** field, upload the SP certificate file. 

    <Callout type="info" emoji="️💡"> 
      SP Private Key and SP Certificate are closely linked and work together for secure communication and data protection in SAML2 authentication:
        * **SP Private Key**: Used to sign SAML requests, decrypt encrypted SAML responses from the IdP, and ensure data integrity.
        * **SP Certificate**: Generated from the SP Private Key and provided to the IdP to verify signed requests from the SP. It is also used to encrypt SAML response data, ensuring secure transmission.

      In simple terms, SP Private Key handles singing and decryption, while SP Certificate handles verification and encryption.
    </Callout>

6. In the **IDP metadata URL** field, enter the IdP metadata URL (such as: `https://saml2.example.com/realms/JumpServer/protocol/saml/descriptor`).
7. In the **IDP metadata XML** field, you can manually enter the IdP Metadata XML. In practice, you only need to provide either the **IDP metadata URL** or the **IDP metadata XML**. If both are present, the **IDP metadata URL** takes precedence.
8. In the **SP advanced settings** field, enter the information you want to configure. For detailed configuration parameters, please refer to [SP advanced settings](https://github.com/SAML-Toolkits/python3-saml/tree/master?tab=readme-ov-file#settings).

    <img src="/images/docs/admin-guides/system-settings/auth/saml2-sp-ad-settings.png" alt="image" width="550"/>

    We will generate SP Metadata based on this configuration for IdP use. 
    <Callout type="info" emoji="️💡"> 
      **SP Metadata** is used to provide essential configuration information about the service provider, including entity ID, endpoint URLs, public certificates, and supported bindings, to facilitate secure communication with the identity provider in SAML authentication.
    </Callout>
    
    You can click **View** in the help information below the **SP cert** field to see the SP metadata.
    <img src="/images/docs/admin-guides/system-settings/auth/saml2-sp-metadata.png" alt="image" width="550"/>

9. In the **User attribute** field, enter the user attribute mapping. The key is the SAML2 user attribute name, and the value is the JumpServer user attribute name (such as: `name`, `username`, `email`, `groups`, `phone`, `comment`).

    <img src="/images/docs/admin-guides/system-settings/auth/saml2-user-attribute.png" alt="image" width="500"/>

10. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
11. In the **Always update user** field, when enabled, after SAML2 user authentication, user information (only includes: `name`, `username`, `email`, `phone`, `comment`) will be checked and updated each time, `groups` are only synchronized when the user is created.
12. In the **Logout completely** field, when enabled, logging out will also log the user out from the SAML2 service.

## Configure OAuth2 server

## Configure WeCOM server

## Configure Dingtalk server

## Configure FeiShu server

## Configure Lark server

## Configure Slack server

## Configure RADIUS server