import { JMSNavSetting } from '@/icons'
import { Steps } from '@/components/docs/steps'
import { Alert } from '@/components/docs/alert'
import { Icon } from '@/components/docs/icons'

# Authentication

This topic describes how to configure third-party authentication services and related user authentication settings.


## Integrate SAML2 auth

**Security Assertion Markup Language 2.0 (SAML2)** is an open standard for exchanging authentication and authorization data between parties, particularly between an Identity Provider and a Service Provider. It allows users to authenticate once with the IdP and access multiple services (SPs) without needing to re-enter credentials.

**Identity Provider (IdP)** is a system that authenticates users and provides their identity information to service providers.

**Service Provider (SP)** is a system or application that relies on an IdP to authenticate users and grant access to its services based on the user identity.

In this case, JumpServer acts only as the SP.

```json copy=true filename="Below is the JumpServer URL information required for IdP SAML2 setup"
{
  "Login": "https://jumpserver.example.com/core/auth/saml2/login/",
  "Login success callback": "https://jumpserver.example.com/core/auth/saml2/callback/",
  "Logout": "https://jumpserver.example.com/core/auth/saml2/logout/",
  "SP metadata": "https://jumpserver.example.com/core/auth/saml2/metadata/"
}
```

**Please follow the steps below to configure SAML2 service authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.

    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > SAML2**.
3. In the **SAML2** field, enable or disable the SAML2 authentication.
4. In the **SP private key** field, upload the SP private key file.
5. In the **SP cert** field, upload the SP certificate file. 
    <Alert type="note">
      SP Private Key and SP Certificate are closely linked and work together for secure communication and data protection in SAML2 authentication:
        * **SP Private Key**: Used to sign SAML requests, decrypt encrypted SAML responses from the IdP, and ensure data integrity.
        * **SP Certificate**: Generated from the SP Private Key and provided to the IdP to verify signed requests from the SP. It is also used to encrypt SAML response data, ensuring secure transmission.

      In simple terms, SP Private Key handles singing and decryption, while SP Certificate handles verification and encryption.
    </Alert>

6. In the **IDP metadata URL** field, enter the IdP metadata URL (such as `https://saml2.example.com/realms/JumpServer/protocol/saml/descriptor`).
7. In the **IDP metadata XML** field, you can manually enter the IdP Metadata XML. In practice, you only need to provide either the **IDP metadata URL** or the **IDP metadata XML**. If both are present, the **IDP metadata URL** takes precedence.
8. In the **SP advanced settings** field, enter the information you want to configure. For detailed configuration parameters, please refer to [SP advanced settings](https://github.com/SAML-Toolkits/python3-saml/tree/master?tab=readme-ov-file#settings).

    <img src="/images/docs/admin-guides/system-settings/auth/saml2-sp-ad-settings.png" alt="image" width="550"/>

    We will generate SP Metadata based on this configuration for IdP use. 
    <Alert type="note">
      **SP Metadata** is used to provide essential configuration information about the service provider, including entity ID, endpoint URLs, public certificates, and supported bindings, to facilitate secure communication with the identity provider in SAML authentication.
    </Alert>
    
    You can click **View** in the help information below the **SP cert** field to see the SP metadata.
    <img src="/images/docs/admin-guides/system-settings/auth/saml2-sp-metadata.png" alt="image" width="550"/>

9. In the **User attribute** field, enter the user attribute mapping. The key is the SAML2 user attribute name, and the value is the JumpServer user attribute name (such as `name`, `username`, `email`, `groups`, `phone`, `comment`).
    ```json copy=true filename="User attribute"
    {
      "uid": "username",
      "email": "email",
      "member": "groups"
    }
    ```

10. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
11. In the **Always update user** field, when enabled, after SAML2 user authentication, user information (only includes: `name`, `username`, `email`, `phone`, `comment`) will be checked and updated each time, `groups` are only synchronized when the user is created.
12. In the **Logout completely** field, when enabled, logging out will also log the user out from the SAML2 service.

## Integrate OAuth2 auth

**Open Authorization 2.0 (OAuth2)** is an open authorization protocol that allows third-party applications to access user resources stored on other service providers (such as Google, Facebook, GitHub, etc.) without exposing the userâ€™s password. OAuth2 enables users to grant third-party applications specific resource permissions without sharing their login credentials.

```json copy=true filename="Below is the JumpServer URL information required for OAuth2 setup"
{
  "Login": "https://jumpserver.example.com/core/auth/oauth2/login/",
  "Login success callback": "https://jumpserver.example.com/core/auth/oauth2/callback/",
  "Logout": "https://jumpserver.example.com/core/auth/oauth2/logout/"
}
```

**Please follow the steps below to configure OAuth2 service authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > OAuth2**.
3. In the **OAuth2** field, enable or disable the OAuth2 authentication.
4. In the **Service provider** field, enter the OAuth2 service provider name (such as `GitHub`, `Google`, `Facebook`, etc.).
5. In the **Logo** field, upload the OAuth2 service provider logo, recommended to use a size of `64px * 64px`.
    <img src="/images/docs/admin-guides/system-settings/auth/oauth2-logo.png" alt="image" width="600"/>
    The **Service provider** and **Logo** will be displayed on the login page.
    <img src="/images/docs/admin-guides/system-settings/auth/oauth2-login-page.png" alt="image" width="400"/>

6. In the **Client ID** field, enter the client ID provided by the OAuth2 service provider.
7. In the **Client secret** field, enter the client secret provided by the OAuth2 service provider.
8. In the **Request method** field, select a method to obtain a token.
    * **GET**: Use the GET method to obtain the token, with the `Client ID` and `Client secret` included in the headers.
    * **POST-DATA**: Use the POST method to obtain a token, with `Client ID` and `Client secret` included as **raw** data in the request body.
    * **POST-JSON**: Use the POST method to obtain a token, with `Client ID` and `Client secret` included as **JSON** data in the request body.
    <img src="/images/docs/admin-guides/system-settings/auth/oauth2-req-method.png" alt="image" width="400"/>

9. In the **Scope** field, Defines the range of user information that the client requests access to in an authorization request. Multiple pieces of information are separated by spaces (such as `user user:email user:login`).
10. In the **Authorization endpoint** field, enter the OAuth2 authorization endpoint (such as `https://github.com/login/oauth/authorize`).
11. In the **Token endpoint** field, enter the OAuth2 token endpoint (such as `https://github.com/login/oauth/access_token`).
12. In the **Userinfo endpoint** field, enter the OAuth2 userinfo endpoint (such as `https://api.github.com/user`).
13. In the **End session endpoint** field, enter the OAuth2 end session endpoint, when the user logs out, this endpoint will be called (such as `https://github.com/logout`).
14. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (such as `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the OAuth2 user attribute name.
    ```json copy=true filename="User attribute"
    {
      "name": "user",
      "username": "name",
      "email": "user:email"
    }
    ```

15. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
16. In the **Always update user** field, when enabled, after OAuth2 user authentication, user information (only includes: `name`, `username`, `email`, `phone`, `comment`) will be checked and updated each time, `groups` are only synchronized when the user is created.
17. In the **Logout completely** field, when enabled, the user will be logged out from the OAuth2 service by calling the **End session endpoint** upon logging out.
18. Click **Submit**.

## Integrate WeCOM auth
**WeCom** authentication is an identity verification method based on WeCom (Enterprise WeChat), supporting OAuth 2.0 authorization, QR code login, and enterprise identity binding, enabling secure and convenient enterprise user login and management.

```json copy=true filename="Below is the JumpServer URL information required for WeCom setup"
{
  "QR login": "https://jumpserver.example.com/core/auth/wecom/qr/login/",
  "QR login callback": "https://jumpserver.example.com/core/auth/wecom/qr/login/callback/",
  "OAuth login": "https://jumpserver.example.com/core/auth/wecom/oauth/login/",
  "OAuth login callback": "https://jumpserver.example.com/core/auth/wecom/oauth/login/callback/"
}
```

**Please follow the steps below to configure WeCom authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > WeCom**.
3. In the **WeCom** field, enable or disable the WeCom authentication.
4. In the **Corporation ID** field, enter the WeCom corporation ID. Uniquely identifies the enterprise in WeCom, and all API requests must include this ID.
5. In the **App agent ID** field, enter the WeCom app agent ID. Used to identify a specific application in WeCom, with each application having a unique Agent ID.
6. In the **App secret** field, enter the WeCom app secret. Used to authenticate the application and obtain an access token for calling the WeCom API.
7. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (such as `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the WeCom user attribute name.
    ```json copy=true filename="User attribute"
    {
      "name": "alias",
      "username": "userid",
      "email": "extattr.attrs[2].value"
    }
    ```

8. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
9. Click **Submit**.

### Test WeCom connection
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > WeCOM**.
3. Scroll to the bottom of the page and click the **Test** button.

## Integrate DingTalk auth

**DingTalk** authentication is an identity verification method based on DingTalk, supporting OAuth 2.0 authorization, QR code login, and enterprise identity binding, enabling secure and convenient enterprise user login and management.

```json copy=true filename="Below is the JumpServer URL information required for DingTalk setup"
{
  "QR login": "https://jumpserver.example.com/core/auth/dingtalk/qr/login/",
  "QR login callback": "https://jumpserver.example.com/core/auth/dingtalk/qr/login/callback/",
  "OAuth login": "https://jumpserver.example.com/core/auth/dingtalk/oauth/login/",
  "OAuth login callback": "https://jumpserver.example.com/core/auth/dingtalk/oauth/login/callback/"
}
```

**Please follow the steps below to configure DingTalk authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > Dingtalk**.
3. In the **Dingtalk** field, enable or disable the DingTalk authentication.
4. In the **Agent ID** field, enter the DingTalk agent ID, which uniquely identifies a micro-application within the enterprise and is primarily used for sending work notifications.
5. In the **App key** field, enter the DingTalk app key, a unique identifier for the application, similar to a `username` for API access.
6. In the **App secret** field, enter the DingTalk app secret, similar to a `password` for API access, used to obtain AccessToken for calling APIs.
7. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (such as `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the DingTalk user attribute name.
    ```json copy=true filename="User attribute"
    {
      "name": "name",
      "username": "name",
      "email": "email"
    }
    ```

8. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
9. Click **Submit**.

### Test DingTalk connection
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Dingtalk**.
3. Scroll to the bottom of the page and click the **Test** button.

## Integrate FeiShu auth
**FeiShu** authentication is an identity verification mechanism based on the FeiShu platform, allowing enterprises and third-party applications to authenticate and authorize users through FeiShu.

```json copy=true filename="Below is the JumpServer URL information required for FeiShu setup"
{
  "QR login": "https://jumpserver.example.com/core/auth/feishu/qr/login/",
  "QR login callback": "https://jumpserver.example.com/core/auth/feishu/qr/login/callback/",
}
```

**Please follow the steps below to configure FeiShu authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>

2. Navigate to **System settings > Authentication > FeiShu**.
3. In the **FeiShu** field, enable or disable the FeiShu authentication.
4. In the **App ID** field, enter the FeiShu app ID, a unique identifier for the application.
5. In the **App secret** field, enter the FeiShu app secret, used to obtain an access token for calling the FeiShu API.
6. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (such as `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the FeiShu user attribute name.
    ```json copy=true filename="User attribute"
    {
      "name": "nickname",
      "username": "user_id",
      "email": "email"
    }
    ```
7. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
8. Click **Submit**.

### Test FeiShu connection
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > FeiShu**.
3. Scroll to the bottom of the page and click the **Test** button.


## Integrate Lark auth

**Lark** authentication is an identity verification mechanism provided by Lark (the international version of Feishu), enabling enterprises and third-party applications to authenticate and authorize users through Lark. 

```json copy=true filename="Below is the JumpServer URL information required for Lark setup"
{
  "QR login": "https://jumpserver.example.com/core/auth/lark/qr/login/",
  "QR login callback": "https://jumpserver.example.com/core/auth/lark/qr/login/callback/",
}
```
**Please follow the steps below to configure Lark authentication.**

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Lark**.
3. In the **Lark** field, enable or disable the Lark authentication.
4. In the **App ID** field, enter the Lark app ID, a unique identifier for the application.
5. In the **App secret** field, enter the Lark app secret, used to obtain an access token for calling the Lark API.
6. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (such as `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the Lark user attribute name.
    ```json copy=true filename="User attribute"
    {
      "name": "nickname",
      "username": "user_id",
      "email": "email"
    }
    ```
7. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
8. Click **Submit**.


## Integrate Slack auth
**Slack** authentication is an identity verification mechanism based on the Slack platform, allowing users to log in to enterprise applications or third-party services using their Slack accounts for secure authentication and authorization. 

```json copy=true filename="Below is the JumpServer URL information required for Slack setup"
{
  "QR login": "https://jumpserver.example.com/core/auth/slack/qr/login/",
  "QR login callback": "https://jumpserver.example.com/core/auth/slack/qr/login/callback/",
}
```
**Please follow the steps below to configure Slack authentication.**
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Slack**.
3. In the **Slack** field, enable or disable the Slack authentication.
4. In the **Client ID** field, enter the Slack client ID, a unique identifier for your Slack application, used to identify the app during the OAuth2.0 authorization process.
5. In the **Client secret** field, enter the Slack client secret, a confidential string associated with your Slack application, used to authenticate the app during the OAuth2.0 token exchange process.
6. In the **Client bot token** field, enter the Slack client bot token, an access token granted to your Slack bot, allowing it to interact with the Slack workspace and perform tasks like sending messages or managing channels.
7. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (such as `name`, `username`, `email`, `groups`, `phone`, `comment`), and the value is the Slack user attribute name.
    ```json copy=true filename="User attribute"
    {
      "name": "real_name",
      "username": "name",
      "email": "profile.email"
    }
    ```
8. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
9. Click **Submit**.

### Test Slack connection
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Slack**.
3. Scroll to the bottom of the page and click the **Test** button.


## Integrate RADIUS auth
**Remote authentication Dial-In User Service (RADIUS)** is a remote authentication mechanism based on the RADIUS protocol, primarily used for network access control. It provides Authentication, Authorization, and Accounting (AAA) functionalities.

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
    <img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Radius**.
3. In the **Radius** field, enable or disable the RADIUS authentication.
4. In the **Host** field, enter the RADIUS server IP address or domain name.
5. In the **Port** field, enter the RADIUS server port number (default is `1812`).
6. In the **Secret** field, enter the shared secret key between the JumpServer and the RADIUS server.
7. In the **OTP in RADIUS** field, when enabled, RADIUS authentication can be used as an MFA method, and users can choose RADIUS when enabling MFA.
8. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
9. Click **Submit**.
