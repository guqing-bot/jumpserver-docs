import { JMSNavSetting } from '@/icons'
import { Callout } from 'nextra/components'
 

# Authentication


This topic describes how to configure third-party authentication services and related user authentication settings.

## Configure email suffix

If the user from the third-party authentication does not have an email field configured, the email suffix is used to automatically generate the user email address by combining the username with the suffix.

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Basic**.
3. In the **Email suffix** field, enter the email suffix (such as `example.com`).
<img src="/images/docs/admin-guides/system-settings/auth/email-suffix.png" alt="image" width="450"/>
4. Click **Submit**.

## Modify the forgot password URL

When the user clicks the **Forgot password?** link on the login page, they will be redirected to this URL.
<img src="/images/docs/admin-guides/system-settings/auth/login-page-forgot-password.png" alt="image" width="350"/>

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Basic**.
3. In the **Forgot password URL** field, enter the URL for the forgot password link.
<img src="/images/docs/admin-guides/system-settings/auth/forgot-password-url.png" alt="image" width="450"/>
4. Click **Submit**.

## Enable or disable user login redirection
If enabled, when an unauthenticated user accesses JumpServer, they will be redirected to a prompt page where they can choose to **Cancel** or **Confirm** the redirection. 
<img src="/images/docs/admin-guides/system-settings/auth/redirecting.png" alt="image" width="450"/>

If disabled, the user will be directly redirected to the third-party authentication page.

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Basic**.
3. In the **Login redirection** field, enable or disable the user login redirection.
<img src="/images/docs/admin-guides/system-settings/auth/login-redirection.png" alt="image" width="450"/>
4. Click **Submit**.

## Configure LDAP (HA) server
**LDAP (HA)** refers to either **LDAP** or **LDAP HA** (High Availability).

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. In the **LDAP (HA)** field, enable or disable the LDAP authentication.
4. In the **Server** field, enter the LDAP server URI (such as `ldap://example.com:389` or `ldaps://example.com:636`). 
<Callout type="info" emoji="️💡"> 
  To configure LDAP TLS certificates, you need upload the following files to the default directory `/data/jumpserver/core/data/certs`, then restart the service:
    * **LDAP**: `ldap_ca.pem`, `ldap_cert.pem`, `ldap_cert.key`
    * **LDAP HA**: `ldap_ha_ca.pem`, `ldap_ha_cert.pem`, `ldap_ha_cert.key`
</Callout>
5. In the **Bind DN** field, enter the distinguished name for binding to the LDAP server (such as `cn=admin,dc=example,dc=com`).
6. In the **Password** field, enter the bind user password, used with `Bind DN` for authentication.
7. In the **Search OU** field, enter the search OU to specify where to start searching for users, use `|` to separate multiple values (such as `ou=users,dc=example,dc=com | ou=tech,dc=example,dc=com`).
<img src="/images/docs/admin-guides/system-settings/auth/ldap-search.png" alt="image" width="550"/>
8. In the **Search filter** field, enter the filter expression for searching LDAP users (such as `(cn=%(user)s)`, `(uid=%(user)s)`, or `(sAMAccountName=%(user)s)`).
9. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name (Available keys: `name`, `username`, `email`, `groups`), and the value is the LDAP user attribute name.
10. In the **Connect timeout (s)** field, enter the LDAP connection timeout in seconds.
11. In the **Search paged size (piece)** field, enter the page size for searching users.
12. In the **User DN cache timeout (s)** field, enter the cache duration for user DN (seconds) to improve login authentication speed. Submit the form to clear the cache if any user DN changes.
13. Click **Submit**.

### Test LDAP (HA) connection
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Scroll to the bottom of the page and click the **Test connection** button.
4. If the connection is successful, a popup at the top of the page will display the number of matched users.
<img src="/images/docs/admin-guides/system-settings/auth/ldap-test-success.png" alt="image" width="450"/>
5. If the connection fails, please adjust the configuration parameters based on the error message and try again.

### Test LDAP (HA) user login
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Complete the LDAP configuration and click **Submit**, then test the connection successfully.
4. Scroll to the bottom of the page and click the **Test login** button.
5. In the popup, enter the LDAP username and password, then click **Confirm**.
<img src="/images/docs/admin-guides/system-settings/auth/ldap-test-login-popup.png" alt="image" width="650"/>

### Import LDAP (HA) users
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Complete the LDAP configuration and click **Submit**, then test the connection successfully.
4. Scroll to the bottom of the page and click the **User import** button.
5. In the popup, you can perform the following actions:
    <img src="/images/docs/admin-guides/system-settings/auth/ldap-import-user.png" alt="image" width="650"/>
    1. At the bottom of the table, click the **Sync users** button to sync LDAP users to the current table.
    2. At the bottom left of the table, in the **Import organization** field, select one or more organizations to be imported.
    3. In the table, select the users you want to import, then click the **Import** button at the bottom to proceed.
    4. At the bottom of the table, click **Import all** to import all users in the table.
    5. At the bottom of the table, click **Cancel** to close the popup.

### Set up LDAP (HA) user sync
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > LDAP (HA)**.
3. Complete the LDAP configuration and click **Submit**, then test the connection successfully.
4. Scroll to the bottom of the page and click the **Sync settings** button.
5. In the popup, you can perform the following actions:
    <img src="/images/docs/admin-guides/system-settings/auth/ldap-sync-settings.png" alt="image" width="550"/>
    1. In the **Organization** field, Select one or more organizations, and the users will be synced to these organizations.
    2. In the **Periodic** field, enable or disable the periodic sync.
    3. Optionally, In the **Crontab** field, enter the crontab expression for the periodic sync. (If empty, `Interval` will be used.)
    4. Optionally, in the **Interval** field, enter the sync interval in hour. (If `Crontab` has a value, prefer using crontab.)
    5. In the **Recipients** fields, select one or more users to receive the sync result.
    6. Click **Submit** to save the settings.

## Configure CAS server
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > CAS**.
3. In the **CAS** field, enable or disable the CAS authentication.
4. In the **Server** field, enter the CAS server URI (such as `https://example.com/cas`).
5. In the **Proxy server** field,  enter the CAS proxy server URI if behind a proxy. For example, if the host listens on `http://foo.bar:8080` but requests use `https://foo.bar:8443`, enter `https://foo.bar:8443`.
6. In the **Version** field, enter the CAS protocol version (Supported versions: `1`, `2`, `3`, `CAS_2_SAML_1_0`).
7. In the **User attribute** field, enter the user attribute mapping. The key is the CAS user attribute name, and the value is the JumpServer user attribute name (Available values: `name`, `username`, `email`, `groups`).
<img src="/images/docs/admin-guides/system-settings/auth/cas-user-attribute.png" alt="image" width="550"/>
8. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.
9. In the **Create user** field, when enabled, a user will be created upon successful authentication. When disabled and the user does not exist, authentication will fail.
10. In the **Logout completely** field, When enabled, logging out will also log the user out from the CAS service.
11. Click **Submit**.

## Configure Passkey server

1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > Passkey**.
3. In the **Passkey** field, enable or disable the Passkey authentication.
4. In the **FIDO server ID** field, enter the full domain name of JumpServer. If not set, it defaults to the request host and matches domains in `DOMAINS` from `config.txt` file. If there are multiple domains, separate them with commas.
5. In the **FIDO server name** field, enter the server name, the default value is `JumpServer`.

## Configure OIDC server
1. In the upper-right corner of any page in JumpServer, click <img src="/images/docs/svg/nav-setting.svg" alt="x" width="15" style={{ display: "inline-block" }}/>.
<img src="/images/docs/admin-guides/system-settings/nav-settings.png" alt="image" width="450"/>
2. Navigate to **System settings > Authentication > OIDC**.
3. In the **OIDC** field, enable or disable the OIDC authentication.
4. In the **Base site URL** field, enter the full domain name of JumpServer, which is used to construct the callback URL.
5. In the **Client id** field, enter the client id provided by the OIDC server.
6. In the **Client secret** field, enter the client secret provided by the OIDC server.
7. In the **Request method** field, select a method to obtain a token:
    <img src="/images/docs/admin-guides/system-settings/auth/oidc-request-method.png" alt="image" width="550"/>
    * **Client Secret Basic**: The `Client id` and `Client secret` are sent in the request headers.
    * **Client Secret Post**: The `Client id` and `Client secret` are sent in the request body.
8. In the **Use keycloak** field, when enabled, Keycloak configuration will be used. The following fields must be provided:
    <img src="/images/docs/admin-guides/system-settings/auth/oidc-use-keycloak.png" alt="image" width="550"/>
    * **Server**: Enter the Keycloak server URI.
    * **Realm name**: Enter the Keycloak realm name.
9. In the **Use keycloak** field, when disabled, native OIDC configuration will be used for better compatibility with other OIDC providers. The following fields must be provided:
    <img src="/images/docs/admin-guides/system-settings/auth/oidc-use-native.png" alt="image" width="700"/>
    * **Provider endpoint**: Enter the OIDC provider endpoint (such as: `https://oidc.example.com`).
    * **Authorization endpoint**: Enter the OIDC authorization endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/auth/`).
    * **Token endpoint**: Enter the OIDC token endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/token/`).
    * **JWKS endpoint**: Enter the OIDC JWKS endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/certs/`).
    * **Userinfo endpoint**: Enter the OIDC userinfo endpoint (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/userinfo/`).
    * **End session endpoint**: Enter the OIDC end session endpoint, when the user logs out, this endpoint will be called. (such as: `https://oidc.example.com/realms/JumpServer/protocol/openid-connect/logout/`).
    * **Signature algorithm**: Enter the OIDC signature algorithm, valid options are `HS256` and `RS256`.
        * **HS256**: Uses the **Client id** as the shared key.
        * **RS256**: Uses the **Signing Key** as the shared key.
        <Callout type="info" emoji="️💡"> 
          The **shared key** in this function is used for HMAC (Hash-based Message Authentication Code) signatures when verifying ID tokens in an OpenID Connect (OIDC) authentication flow.
        </Callout>
    * **Signing key**: When the **Signature Algorithm** is `RS256`, the signing key will be used for HMAC (Hash-based Message Authentication Code) signature verification or JWT (JSON Web Token) decryption to ensure the security of OIDC authentication.
    * **Enable PKCE**: Enable PKCE (Proof Key for Code Exchange) protects the authorization code flow to prevent authorization code interception attacks.
    * **Scopes**: Defines the range of user information that the client requests access to from the Identity Provider (IdP) in an authorization request. Multiple pieces of information are separated by spaces (such as: `openid profile email`).
    * **ID token max age (s)**: The maximum age of the ID Token, in seconds. After it expires, a new one will be automatically obtained using the refresh token.
    * **ID token include claims**: When enabled, the ID Token includes the userinfo scope and claims. When disabled, claims will be retrieved from the userinfo endpoint provided by the OP (OpenID Provider). Refer to the [Standard Claims](https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims).
    * **Use state**: Recommend to enable, state can prevent Cross-Site Request Forgery (CSRF) attacks and ensure consistency between the request and the callback.
    * **Use nonce**: Recommend to enable too, nonce can prevent replay attacks.
    * **Always update user**: When enabled, after OIDC user authentication, user information (only including: `name`, `username`, and `email`) will be checked and updated each time.
10. In the **Ignore SSL verification** field, when enabled, SSL certificate verification is ignored when sending requests to the OP (OIDC Provider).
11. In the **Share session** field, when enabled, the session will be logged out simultaneously when a user logs out from other applications.
12. In the **User attribute** field, enter the user attribute mapping. The key is the JumpServer user attribute name, and the value is the OIDC user attribute name (Available values: `name`, `username`, `email`, `groups`).
<img src="/images/docs/admin-guides/system-settings/auth/oidc-user-attribute.png" alt="image" width="550"/>
13. In the **Organization** field, after authentication and creation, the user will be added to the selected organization.


## Configure SAML2 server

## Configure OAuth2 server

## Configure WeCOM server

## Configure Dingtalk server

## Configure FeiShu server

## Configure Lark server

## Configure Slack server

## Configure RADIUS server